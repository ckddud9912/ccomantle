<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>꼬맨틀 게임</title>

<style>
body { background:#f5f5f5; font-family:Arial; display:flex; justify-content:center; }
.container {
    width:900px; background:white; margin-top:40px; padding:30px;
    border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.05);
}
.inputbox {
    width:100%; padding:14px; font-size:17px;
    border-radius:10px; border:1px solid #ccc; margin-bottom:20px;
}
table { width:100%; border-collapse:collapse; margin-top:20px; }
th, td { padding:12px; border-bottom:1px solid #ddd; text-align:center; }
th { background:#eee; }
.progress { width:180px; height:12px; background:#ddd; border-radius:6px; overflow:hidden; }
.progress_inner { height:100%; background:#4b9cfc; }
#sim_info { margin:15px 0; font-size:14px; color:#444; line-height:1.5; }
</style>
</head>

<body>

<div class="container">
    <h2 id="team_label"></h2>

    <div id="sim_info"></div>

    <input id="guess" class="inputbox" placeholder="단어를 입력하고 Enter를 누르세요">

    <table>
        <thead>
            <tr>
                <th>팀</th>
                <th>단어</th>
                <th>유사도</th>
                <th>유사도 순위</th>
                <th>바</th>
            </tr>
        </thead>
        <tbody id="leaderBody"></tbody>
    </table>
</div>

<script>
const team = localStorage.getItem("team_name") || "미등록 팀";
document.getElementById("team_label").innerText = "팀: " + team;

const input = document.getElementById("guess");
const body = document.getElementById("leaderBody");
const simInfoDiv = document.getElementById("sim_info");

async function refreshLeaderboard() {
    const r = await fetch("/leaderboard");
    const data = await r.json();
    if (!data.ok) return;

    const s = data.stats;
    simInfoDiv.innerHTML = `
        정답 단어와 가장 유사한 단어의 유사도는 <b>${s.top1}</b> 입니다.<br>
        10번째로 유사한 단어의 유사도는 <b>${s.top10}</b>이고,
        1,000번째로 유사한 단어의 유사도는 <b>${s.top1000}</b> 입니다.
    `;

    body.innerHTML = "";
    data.leaderboard.forEach(row => {
        const rankNum = (row.rank === "1000위 이상") ? 1000 : row.rank;
        const bluePercent = Math.max(0, (1000 - rankNum) / 1000 * 100);

        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${row.team}</td>
            <td>${row.word}</td>
            <td>${row.similarity}</td>
            <td>${row.rank}</td>
            <td>
                <div class="progress">
                    <div class="progress_inner" style="width:${bluePercent}%"></div>
                </div>
            </td>
        `;
        body.appendChild(tr);
    });
}

setInterval(refreshLeaderboard, 1000);

input.addEventListener("keydown", async (e) => {
    if (e.key === "Enter") {
        const word = input.value.trim();
        if (!word) return;
        const r = await fetch(`/guess?word=${word}&team=${team}`);
        input.value = "";
    }
});
</script>

</body>
</html>
