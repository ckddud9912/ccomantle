<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ê¼¬ë§¨í‹€ ê²Œì„</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #0d1117;
        color: #fff;
        margin: 0;
        padding: 40px;
        display: flex;
        gap: 40px;
    }

    /* ì™¼ìª½ ì…ë ¥ ë°•ìŠ¤ */
    .left-box {
        width: 40%;
        background: #111827;
        padding: 25px;
        border-radius: 12px;
        border: 1px solid #1f2937;
    }

    .left-box h1 {
        font-size: 28px;
        margin-bottom: 10px;
    }

    .left-box small {
        opacity: 0.8;
    }

    input {
        width: 100%;
        padding: 12px;
        margin-top: 10px;
        border-radius: 8px;
        border: 1px solid #374151;
        background: #1f2937;
        color: #fff;
        font-size: 16px;
    }

    button {
        margin-top: 15px;
        width: 100%;
        padding: 12px;
        background: #fbbf24;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 18px;
        font-weight: bold;
    }

    /* ê²°ê³¼ ì¶œë ¥ */
    .result-text {
        margin-top: 15px;
        font-size: 16px;
    }

    /* ì˜¤ë¥¸ìª½ ë¦¬ë”ë³´ë“œ ë°•ìŠ¤ */
    .right-box {
        flex-grow: 1;
        background: #111827;
        padding: 25px;
        border-radius: 12px;
        border: 1px solid #1f2937;
    }

    .right-title {
        font-size: 28px;
        margin-bottom: 5px;
    }

    .hint-box {
        margin-bottom: 15px;
        opacity: 0.9;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        font-size: 15px;
    }

    th, td {
        padding: 10px;
        border-bottom: 1px solid #374151;
        text-align: center;
    }

    .bar-box {
        width: 100%;
        height: 10px;
        background: #374151;
        border-radius: 6px;
        overflow: hidden;
        margin-top: 3px;
    }

    .bar-fill {
        height: 100%;
        transition: width 0.5s ease;
        background: #f97316;
    }

    .row-appear {
        animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(6px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>
</head>

<body>

<!-- ì™¼ìª½ ì˜ì—­ -->
<div class="left-box">
    <h1>ğŸ® ê¼¬ë§¨í‹€ ê²Œì„</h1>
    <small>ì˜¤ëŠ˜ì˜ ì •ë‹µ ë‹¨ì–´ë¥¼ ë§ì¶°ë³´ì„¸ìš”!</small>

    <p id="guide-text" style="opacity:0.8; margin-top:15px; font-size:14px;">
        ì •ë‹µ ë‹¨ì–´ì˜ ìœ ì‚¬ë„ ì ìˆ˜ëŠ” 100.00ì  ì…ë‹ˆë‹¤.<br>
        ì •ë‹µê³¼ ê°€ì¥ ìœ ì‚¬í•œ ë‹¨ì–´ì˜ ì ìˆ˜ëŠ” <span id="best0">-</span>ì  ì…ë‹ˆë‹¤.<br>
        ì•„ì§ 20ê°œ ì´ìƒ ë‹¨ì–´ê°€ ì œì¶œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
    </p>

    <input id="team" placeholder="íŒ€ ì´ë¦„ ì…ë ¥">
    <input id="word" placeholder="ì œì¶œ ë‹¨ì–´ (ì˜ˆ: ë°”ë‹¤ / ë…¸ì„ / ì¹œì ˆ)">
    <button onclick="sendGuess()">ì œì¶œ</button>

    <div class="result-text" id="latest"></div>
</div>

<!-- ì˜¤ë¥¸ìª½ ì˜ì—­ -->
<div class="right-box">
    <div class="right-title">ğŸ† ë¦¬ë”ë³´ë“œ</div>

    <!-- ìœ ì‚¬ë„ ì•ˆë‚´ ì˜ì—­ (2ë²ˆ UIì˜ ìš”ì†Œ) -->
    <div class="hint-box">
        ì •ë‹µê³¼ ê°€ì¥ ìœ ì‚¬í•œ ë‹¨ì–´ ìœ ì‚¬ë„: <span id="best"></span><br>
        20ë²ˆì§¸ë¡œ ìœ ì‚¬í•œ ë‹¨ì–´ ìœ ì‚¬ë„: <span id="tw"></span><br>
        1000ë²ˆì§¸ë¡œ ìœ ì‚¬í•œ ë‹¨ì–´ ìœ ì‚¬ë„: <span id="th"></span>
    </div>

    <table>
        <thead>
            <tr>
                <th>ìˆœìœ„</th>
                <th>íŒ€</th>
                <th>ë‹¨ì–´</th>
                <th>ì ìˆ˜</th>
                <th>ìœ ì‚¬ë„ ë°”</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>

</div>

<script>
let teamColors = {};
function getTeamColor(team) {
    if (!teamColors[team]) {
        teamColors[team] = "#" + Math.floor(Math.random()*16777215).toString(16);
    }
    return teamColors[team];
}

async function sendGuess() {
    const team = document.getElementById("team").value.trim();
    const word = document.getElementById("word").value.trim();
    if (!team || !word) return;

    const res = await fetch("/guess", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ team, word })
    });
    const data = await res.json();

    if (data.entry) {
        document.getElementById("latest").innerHTML =
            `[${data.entry.team}] ${data.entry.word} â†’ ì ìˆ˜ ${Math.round(data.entry.score)}, ìˆœìœ„ ${data.entry.rank}`;
    }

    loadBoard();
}

async function loadBoard() {
    const res = await fetch("/leaderboard");
    const data = await res.json();

    // ì•ˆë‚´ í‘œì‹œ
    document.getElementById("best").innerText = data.sim_top1?.toFixed(4) || "-";
    document.getElementById("tw").innerText = data.sim_top20?.toFixed(4) || "-";
    document.getElementById("th").innerText = data.sim_top1000?.toFixed(4) || "-";

    document.getElementById("best0").innerText = data.sim_top1 ? (data.sim_top1 * 100).toFixed(2) : "-";

    // ë¦¬ë”ë³´ë“œ
    const tb = document.getElementById("tbody");
    tb.innerHTML = "";

    let rankNum = 1;
    for (let row of data.submissions) {

        const tr = document.createElement("tr");
        tr.classList.add("row-appear");

        const rankTd = document.createElement("td");
        rankTd.innerText = rankNum++;
        tr.appendChild(rankTd);

        const teamTd = document.createElement("td");
        teamTd.innerText = row.team;
        tr.appendChild(teamTd);

        const wordTd = document.createElement("td");
        wordTd.innerText = row.word;
        tr.appendChild(wordTd);

        const scoreTd = document.createElement("td");
        scoreTd.innerText = Math.round(row.score);
        tr.appendChild(scoreTd);

        const barTd = document.createElement("td");
        const box = document.createElement("div");
        box.className = "bar-box";

        const fill = document.createElement("div");
        fill.className = "bar-fill";

        const pct = (row.score + 100) / 200 * 100;
        fill.style.width = pct + "%";
        fill.style.background = getTeamColor(row.team);

        box.appendChild(fill);
        barTd.appendChild(box);
        tr.appendChild(barTd);

        tb.appendChild(tr);
    }
}

loadBoard();
setInterval(loadBoard, 1500);
</script>

</body>
</html>
