<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>꼬맨틀 확장판</title>

<style>
body { background:#f5f5f5; font-family:Arial; display:flex; justify-content:center; }
.container {
    width:900px; background:white; margin-top:40px; padding:30px;
    border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.05);
}
.inputbox {
    width:100%; padding:14px; font-size:17px;
    border-radius:10px; border:1px solid #ccc; margin-bottom:20px;
}
table { width:100%; border-collapse:collapse; margin-top:20px; }
th, td { padding:12px; border-bottom:1px solid #ddd; text-align:center; }
th { background:#eee; }

.progress {
    height:12px; background:#ddd; border-radius:6px; overflow:hidden;
}
.progress_inner {
    height:100%; background:#4b9cfc;
}
#sim_info { margin:15px 0; font-size:14px; color:#444; line-height:1.6; }
</style>
</head>

<body>

<div class="container">
    <h2 id="team_label"></h2>

    <div id="sim_info"></div>

    <input id="guess" class="inputbox" placeholder="단어 입력 후 Enter">

    <table>
        <thead>
            <tr>
                <th>팀</th>
                <th>단어</th>
                <th>유사도</th>
                <th>유사도 순위 + 그래프</th>
            </tr>
        </thead>
        <tbody id="leaderBody"></tbody>
    </table>
</div>

<script>
const teamName = localStorage.getItem("team_name") || "팀 미등록";

document.getElementById("team_label").innerText = "팀: " + teamName;
const input = document.getElementById("guess");
const leaderBody = document.getElementById("leaderBody");
const simInfo = document.getElementById("sim_info");

input.addEventListener("keydown", async (e) => {
    if (e.key === "Enter") {
        const word = input.value.trim();
        if (!word) return;

        await fetch(`/guess?word=${word}&team=${encodeURIComponent(teamName)}`);
        input.value = "";
    }
});

async function loadBoard() {
    const r = await fetch("/leaderboard");
    const data = await r.json();

    leaderBody.innerHTML = "";

    data.leaderboard.forEach(row => {
        const rankVal = row.rank === "1000위 이상" ? 1000 : row.rank;
        const percent = Math.max(5, (1000 - rankVal) / 1000 * 100);

        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${row.team}</td>
            <td>${row.word}</td>
            <td>${row.similarity}</td>
            <td>
                ${row.rank}
                <div class="progress">
                    <div class="progress_inner" style="width:${percent}%"></div>
                </div>
            </td>
        `;
        leaderBody.appendChild(tr);
    });
}

setInterval(loadBoard, 1200);
</script>

</body>
</html>
