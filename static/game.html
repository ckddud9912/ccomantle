<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>꼬맨틀 팀대항전</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #111;
        color: #fff;
        margin: 0;
        padding: 20px;
    }

    h1 {
        font-size: 26px;
        text-align: center;
        margin-bottom: 15px;
    }

    .input-area {
        text-align: center;
        margin-bottom: 20px;
    }

    input {
        padding: 8px;
        font-size: 16px;
        width: 180px;
        background: #222;
        color: #fff;
        border: 1px solid #444;
    }

    button {
        padding: 8px 16px;
        font-size: 16px;
        cursor: pointer;
        margin-left: 6px;
        background: #333;
        color: #fff;
        border: 1px solid #555;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 25px;
    }

    th, td {
        padding: 10px;
        text-align: center;
        border-bottom: 1px solid #444;
    }

    .bar-box {
        width: 100%;
        height: 16px;
        background: #333;
        border-radius: 8px;
        overflow: hidden;
    }

    .bar-fill {
        height: 100%;
        transition: width 0.6s ease;
    }

    .row-appear {
        animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(6px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>
</head>

<body>

<h1>오늘의 정답 단어를 맞춰보세요!</h1>

<div class="input-area">
    <input id="team" placeholder="팀 이름 입력">
    <input id="word" placeholder="단어 입력">
    <button onclick="sendGuess()">제출</button>
</div>

<div id="meta-box" style="text-align:center; margin-top:15px; font-size:15px;">
    <div>정답과 가장 유사한 단어 유사도: <span id="best"></span></div>
    <div>20번째로 유사한 단어 유사도: <span id="tw"></span></div>
    <div>1000번째로 유사한 단어 유사도: <span id="th"></span></div>
</div>

<table id="leader">
    <thead>
        <tr>
            <th>팀</th>
            <th>단어</th>
            <th>순위</th>
            <th>점수</th>
            <th>유사도 바</th>
        </tr>
    </thead>
    <tbody id="tbody"></tbody>
</table>

<script>
let teamColors = {};

function getTeamColor(team) {
    if (!teamColors[team]) {
        teamColors[team] = "#" + Math.floor(Math.random()*16777215).toString(16);
    }
    return teamColors[team];
}

async function sendGuess() {
    const team = document.getElementById("team").value.trim();
    const word = document.getElementById("word").value.trim();
    if (!team || !word) return;

    await fetch("/guess", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ team, word })
    });

    document.getElementById("word").value = "";
    loadBoard();
}

async function loadBoard() {
    const res = await fetch("/leaderboard");
    const data = await res.json();

    document.getElementById("best").innerText = data.sim_top1 ? data.sim_top1.toFixed(4) : "-";
    document.getElementById("tw").innerText = data.sim_top20 ? data.sim_top20.toFixed(4) : "-";
    document.getElementById("th").innerText = data.sim_top1000 ? data.sim_top1000.toFixed(4) : "-";

    const tb = document.getElementById("tbody");
    tb.innerHTML = "";

    for (let row of data.submissions) {

        const tr = document.createElement("tr");
        tr.classList.add("row-appear");

        const teamTd = document.createElement("td");
        teamTd.innerText = row.team;
        tr.appendChild(teamTd);

        const wordTd = document.createElement("td");
        wordTd.innerText = row.word;
        tr.appendChild(wordTd);

        const rankTd = document.createElement("td");
        rankTd.innerText = row.rank;
        tr.appendChild(rankTd);

        const scoreTd = document.createElement("td");
        scoreTd.innerText = Math.round(row.score);
        tr.appendChild(scoreTd);

        const barTd = document.createElement("td");
        const box = document.createElement("div");
        box.className = "bar-box";

        const fill = document.createElement("div");
        fill.className = "bar-fill";

        if (typeof row.score === "number") {
            const pct = (row.score + 100) / 200 * 100;
            fill.style.width = pct + "%";
            fill.style.background = getTeamColor(row.team);
        } else {
            fill.style.width = "100%";
            fill.style.background = "#FFD700";
        }

        box.appendChild(fill);
        barTd.appendChild(box);
        tr.appendChild(barTd);

        tb.appendChild(tr);
    }
}

loadBoard();
setInterval(loadBoard, 1500);
</script>

</body>
</html>
