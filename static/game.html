<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ê¼¬ë§¨í‹€ ê²Œì„</title>
<style>
body {
    background:#f5f5f5;
    font-family:Arial, sans-serif;
    display:flex;
    justify-content:center;
}
.container {
    width:900px;
    background:white;
    margin-top:40px;
    padding:30px;
    border-radius:12px;
    box-shadow:0 4px 20px rgba(0,0,0,0.05);
}
h1 { margin-top:0; }
.team-label {
    font-size:22px;
    font-weight:bold;
    margin-bottom:10px;
}
.stats {
    margin-bottom:20px;
    line-height:1.6;
}
.inputbox {
    width:100%;
    padding:14px;
    font-size:17px;
    border-radius:10px;
    border:1px solid #ccc;
    margin-bottom:20px;
    box-sizing:border-box;
}
table {
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
}
th, td {
    padding:10px;
    border-bottom:1px solid #eee;
    font-size:14px;
    text-align:center;
}
th {
    background:#f0f0f0;
}
td.word-cell {
    text-align:left;
}
.progress {
    width:120px;
    height:10px;
    background:#e0e0e0;
    border-radius:5px;
    overflow:hidden;
    margin:0 auto;
}
.progress_inner {
    height:100%;
    background:#4b9cfc;
}
.info-box {
    margin-top:25px;
    padding:12px 16px;
    background:#f8f8f8;
    border-radius:8px;
    font-size:13px;
    color:#444;
    line-height:1.6;
}
</style>
</head>

<body>
<div class="container">
    <div class="team-label" id="team_label"></div>

    <div class="stats" id="stats-msg">
        ì§„í–‰ìê°€ ì •ë‹µì„ ì„¤ì •í•˜ë©´ ìœ ì‚¬ë„ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.
    </div>

    <input id="guess" class="inputbox" placeholder="ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ê³  Enterë¥¼ ëˆ„ë¥´ì„¸ìš”">

    <h3>ğŸ“Š ë¦¬ë”ë³´ë“œ (ìœ ì‚¬ë„ ë†’ì€ ìˆœ)</h3>

    <table>
        <thead>
            <tr>
                <th>íŒ€</th>
                <th>ë‹¨ì–´</th>
                <th>ìœ ì‚¬ë„</th>
                <th>ìœ ì‚¬ë„ ìˆœìœ„</th>
            </tr>
        </thead>
        <tbody id="leaderBody"></tbody>
    </table>

    <div class="info-box">
        <strong>Q. ìœ ì‚¬ë„ëŠ” ë¬´ì—‡ì¸ê°€ìš”?</strong><br>
        ê¼¬ë§¨í‹€ì—ì„œ ìœ ì‚¬ë„ëŠ” ì¶”ì¸¡í•œ ë‹¨ì–´ì™€ ì •ë‹µ ë‹¨ì–´ê°€ ì˜ë¯¸ì ìœ¼ë¡œ ì–¼ë§ˆë‚˜ ë¹„ìŠ·í•œì§€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì ìˆ˜ì…ë‹ˆë‹¤.
        ëŒ€ëµ <strong>-20ì—ì„œ +70 ì‚¬ì´</strong>ì˜ ê°’ìœ¼ë¡œ í‘œì‹œë˜ë©°, ê°’ì´ í´ìˆ˜ë¡ ì •ë‹µì— ë” ê°€ê¹ë‹¤ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
        ì´ ê²Œì„ì—ì„œëŠ” FastTextë¼ëŠ” í•œêµ­ì–´ ë‹¨ì–´ ì„ë² ë”©ì„ ì‚¬ìš©í•´ ëª¨ë“  ë‹¨ì–´ì˜ ì˜ë¯¸ ë²¡í„°ë¥¼ ë¹„êµí•˜ê³ ,
        ê·¸ ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìœ ì‚¬ë„ ì ìˆ˜ì™€ ìœ ì‚¬ë„ ìˆœìœ„ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
    </div>
</div>

<script>
const teamName = localStorage.getItem("team_name") || "ë¯¸ë“±ë¡ íŒ€";
document.getElementById("team_label").innerText = "íŒ€: " + teamName;

const input = document.getElementById("guess");
const leaderBody = document.getElementById("leaderBody");
const statsMsg = document.getElementById("stats-msg");

// ë‹¨ì–´ ì œì¶œ
input.addEventListener("keydown", async (e) => {
    if (e.key === "Enter") {
        const word = input.value.trim();
        if (!word) return;

        try {
            const r = await fetch(`/guess?word=${encodeURIComponent(word)}&team=${encodeURIComponent(teamName)}`);
            const data = await r.json();

            if (!data.ok) {
                alert(data.error || "ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            } else if (data.rank_label === "1000ìœ„ ì´ìƒ") {
                // ê·¸ëƒ¥ ì°¸ê³ ë§Œ (ì›í•˜ë©´ ë³„ë„ ì²˜ë¦¬ ê°€ëŠ¥)
            }
        } catch (err) {
            alert("ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }

        input.value = "";
    }
});

// ë¦¬ë”ë³´ë“œ ê°±ì‹ 
async function updateLeaderboard() {
    try {
        const r = await fetch("/leaderboard");
        const data = await r.json();
        if (!data.ok) return;

        leaderBody.innerHTML = "";

        data.leaderboard.forEach(row => {
            const tr = document.createElement("tr");

            // ìœ ì‚¬ë„ -20 ~ 70 ë²”ìœ„ë¥¼ 0~100 ë§‰ëŒ€ ë¹„ìœ¨ë¡œ
            const barPercent = Math.max(0, Math.min(100, ((row.similarity + 20) / 90) * 100));

            tr.innerHTML = `
                <td>${row.team}</td>
                <td class="word-cell">${row.word}</td>
                <td>${row.similarity}</td>
                <td>
                    ${row.rank_label || ""}
                    <div class="progress">
                        <div class="progress_inner" style="width:${barPercent}%;"></div>
                    </div>
                </td>
            `;
            leaderBody.appendChild(tr);
        });
    } catch (e) {
        // console.log(e);
    }
}

// ìœ ì‚¬ë„ ì„¤ëª… í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
async function updateStats() {
    try {
        const r = await fetch("/stats");
        const data = await r.json();
        if (!data.ok) {
            statsMsg.innerHTML = "ì§„í–‰ìê°€ ì•„ì§ ì •ë‹µì„ ì„¤ì •í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
            return;
        }

        const max = data.max_sim;
        const top10 = data.top10_sim;
        const top1000 = data.top1000_sim;

        statsMsg.innerHTML = `
        ì •ë‹µ ë‹¨ì–´ì™€ ê°€ì¥ ìœ ì‚¬í•œ ë‹¨ì–´ì˜ ìœ ì‚¬ë„ëŠ” <strong>${max}</strong> ì…ë‹ˆë‹¤.<br>
        10ë²ˆì§¸ë¡œ ìœ ì‚¬í•œ ë‹¨ì–´ì˜ ìœ ì‚¬ë„ëŠ” <strong>${top10}</strong>ì´ê³ ,<br>
        1,000ë²ˆì§¸ë¡œ ìœ ì‚¬í•œ ë‹¨ì–´ì˜ ìœ ì‚¬ë„ëŠ” <strong>${top1000}</strong> ì…ë‹ˆë‹¤.
        `;
    } catch (e) {
        statsMsg.innerHTML = "ìœ ì‚¬ë„ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
    }
}

// ì¼ì • ê°„ê²©ìœ¼ë¡œ ê°±ì‹ 
setInterval(updateLeaderboard, 1000);
setInterval(updateStats, 5000);
updateLeaderboard();
updateStats();
</script>
</body>
</html>
