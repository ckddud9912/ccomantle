<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê¼¬ë§¨í‹€ ê´€ë¦¬ì</title>
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 24px;
      background: #020617;
      color: #e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .card {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px 22px;
      background: #020617;
      border-radius: 16px;
      border: 1px solid #1e293b;
      box-shadow: 0 16px 40px rgba(15,23,42,0.8);
    }

    h1 {
      margin: 0 0 10px 0;
      font-size: 24px;
      color: #fbbf24;
    }

    p {
      margin: 0 0 14px 0;
      font-size: 13px;
      color: #9ca3af;
    }

    .section-title {
      margin-top: 18px;
      margin-bottom: 6px;
      font-size: 14px;
      font-weight: 600;
    }

    input[type="text"],
    input[type="number"] {
      width: 100%;
      padding: 9px 10px;
      border-radius: 8px;
      border: 1px solid #334155;
      background: #020617;
      color: #e5e7eb;
      font-size: 14px;
    }

    button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      margin-top: 8px;
      margin-right: 6px;
    }

    .btn-primary {
      background: #facc15;
      color: #111827;
    }

    .btn-ghost {
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #334155;
    }

    .btn-danger {
      background: #ef4444;
      color: #f9fafb;
    }

    .status-line {
      margin-top: 6px;
      font-size: 13px;
      color: #9ca3af;
    }

    .round-buttons button {
      min-width: 38px;
      padding-inline: 0;
    }

    hr {
      border: none;
      border-top: 1px solid #111827;
      margin: 18px 0;
    }

    /* TOP1000 íŒì—… */
    #top1000-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.96);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    #top1000-card {
      width: min(900px, 96vw);
      max-height: 90vh;
      background: #020617;
      border-radius: 16px;
      border: 1px solid #1e293b;
      padding: 18px 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.9);
      display: flex;
      flex-direction: column;
    }

    #top1000-card h2 {
      margin: 0 0 6px 0;
      font-size: 20px;
      color: #fbbf24;
    }

    #top1000-card p {
      margin: 0 0 8px 0;
      font-size: 13px;
      color: #9ca3af;
    }

    #top1000-body {
      flex: 1;
      overflow-y: auto;
      margin-top: 4px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    th, td {
      padding: 6px 6px;
      border-bottom: 1px solid #111827;
      text-align: center;
      white-space: nowrap;
    }

    th {
      color: #9ca3af;
      font-weight: 500;
      font-size: 12px;
    }

    #top1000-close {
      margin-top: 10px;
      align-self: flex-end;
      padding-inline: 10px;
      font-size: 12px;
      background: #111827;
      color: #e5e7eb;
    }
  </style>
</head>
<body>
<div class="card">
  <h1>ğŸ›  ê¼¬ë§¨í‹€ ê´€ë¦¬ì</h1>
  <p>ì •ë‹µ ì„¤ì •, ë¼ìš´ë“œ ì´ë™, ê²½ê¸° ì¢…ë£Œ ë° ë‹¨ì–´ ìœ ì‚¬ë„ 1000ìœ„ ì¡°íšŒë¥¼ í•  ìˆ˜ ìˆëŠ” í™”ë©´ì…ë‹ˆë‹¤.</p>

  <div>
    <div class="section-title">ì •ë‹µ ë‹¨ì–´ ì„¤ì •</div>
    <input type="text" id="answer-input" placeholder="ì˜ˆ: ê¸°ëŒ€ / ëŒ€ë°• / í–‰ìš´" />
    <button class="btn-primary" id="btn-set-answer">ì •ë‹µ ì„¤ì •</button>
    <div class="status-line" id="answer-status">í˜„ì¬ ì •ë‹µ: -</div>
  </div>

  <hr>

  <div>
    <div class="section-title">ë¼ìš´ë“œ ì œì–´ (1~6)</div>
    <div class="round-buttons">
      <button class="btn-ghost" data-round="1">1R</button>
      <button class="btn-ghost" data-round="2">2R</button>
      <button class="btn-ghost" data-round="3">3R</button>
      <button class="btn-ghost" data-round="4">4R</button>
      <button class="btn-ghost" data-round="5">5R</button>
      <button class="btn-ghost" data-round="6">6R</button>
    </div>
    <div class="status-line" id="round-status">í˜„ì¬ ë¼ìš´ë“œ: -</div>
  </div>

  <hr>

  <div>
    <div class="section-title">ê²½ê¸° ì»¨íŠ¸ë¡¤</div>
    <button class="btn-ghost" id="btn-top1000">ì •ë‹µ ê¸°ì¤€ ìƒìœ„ 1000 ë‹¨ì–´ ë³´ê¸°</button>
    <button class="btn-danger" id="btn-end-game">ê²½ê¸° ì¢…ë£Œ</button>
    <div class="status-line" id="game-status">ê²½ê¸° ì§„í–‰ ì¤‘</div>
  </div>
</div>

<!-- TOP1000 íŒì—… -->
<div id="top1000-overlay">
  <div id="top1000-card">
    <h2>ì •ë‹µ ê¸°ì¤€ ìƒìœ„ 1000 ë‹¨ì–´</h2>
    <p id="top1000-title">ì •ë‹µ ë‹¨ì–´: -</p>
    <div id="top1000-body">
      <table>
        <thead>
        <tr>
          <th>ìˆœìœ„</th>
          <th>ë‹¨ì–´</th>
          <th>ìœ ì‚¬ë„</th>
        </tr>
        </thead>
        <tbody id="top1000-tbody"></tbody>
      </table>
    </div>
    <button id="top1000-close">ë‹«ê¸°</button>
  </div>
</div>

<script>
  const answerInput = document.getElementById("answer-input");
  const answerStatus = document.getElementById("answer-status");
  const roundStatus = document.getElementById("round-status");
  const gameStatus = document.getElementById("game-status");

  document.getElementById("btn-set-answer").addEventListener("click", setAnswer);
  document.getElementById("btn-top1000").addEventListener("click", openTop1000);
  document.getElementById("btn-end-game").addEventListener("click", endGame);
  document.querySelectorAll(".round-buttons button").forEach(btn => {
    btn.addEventListener("click", () => changeRound(parseInt(btn.dataset.round, 10)));
  });

  document.getElementById("top1000-close").addEventListener("click", () => {
    document.getElementById("top1000-overlay").style.display = "none";
  });

  async function setAnswer() {
    const answer = answerInput.value.trim();
    if (!answer) return;

    try {
      const res = await fetch("/set_answer", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ answer })
      });
      const data = await res.json();
      if (data.error) {
        alert(data.error);
        return;
      }
      answerStatus.textContent = `í˜„ì¬ ì •ë‹µ: ${data.answer}`;
      gameStatus.textContent = "ê²½ê¸° ì§„í–‰ ì¤‘";
    } catch (e) {
      console.error(e);
    }
  }

  async function changeRound(round) {
    try {
      const res = await fetch("/set_round", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ round })
      });
      const data = await res.json();
      if (data.error) {
        alert(data.error);
        return;
      }
      roundStatus.textContent = `í˜„ì¬ ë¼ìš´ë“œ: ${data.current_round}`;
    } catch (e) {
      console.error(e);
    }
  }

  async function endGame() {
    if (!confirm("ì •ë§ë¡œ ê²½ê¸°ë¥¼ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
    try {
      const res = await fetch("/end_game", { method: "POST" });
      const data = await res.json();
      if (data.status === "finished") {
        gameStatus.textContent = "ê²½ê¸° ì¢…ë£Œë¨ (ê²Œì„ í˜ì´ì§€ì—ì„œ ìµœì¢… ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤)";
        alert("ê²½ê¸°ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê²Œì„ í˜ì´ì§€ì—ì„œ ìµœì¢… ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.");
      }
    } catch (e) {
      console.error(e);
    }
  }

  async function openTop1000() {
    try {
      const res = await fetch("/top1000");
      const data = await res.json();
      if (data.error) {
        alert(data.error);
        return;
      }

      document.getElementById("top1000-title").textContent =
        `ì •ë‹µ ë‹¨ì–´: ${data.answer ?? "-"}`;

      const tbody = document.getElementById("top1000-tbody");
      tbody.innerHTML = "";
      (data.top1000 || []).forEach(row => {
        const tr = document.createElement("tr");

        const tdRank = document.createElement("td");
        tdRank.textContent = row.rank;
        tr.appendChild(tdRank);

        const tdWord = document.createElement("td");
        tdWord.textContent = row.word;
        tr.appendChild(tdWord);

        const tdSim = document.createElement("td");
        tdSim.textContent = row.similarity.toFixed(4);
        tr.appendChild(tdSim);

        tbody.appendChild(tr);
      });

      document.getElementById("top1000-overlay").style.display = "flex";
    } catch (e) {
      console.error(e);
    }
  }

  // ì´ˆê¸° ìƒíƒœ ë™ê¸°í™”ìš© (ì„ íƒ)
  (async function initStatus() {
    try {
      const res = await fetch("/leaderboard");
      const data = await res.json();
      if (data.answer) {
        answerStatus.textContent = `í˜„ì¬ ì •ë‹µ: ${data.answer}`;
      }
      roundStatus.textContent = `í˜„ì¬ ë¼ìš´ë“œ: ${data.current_round ?? "-"}`;
      gameStatus.textContent = data.finished ? "ê²½ê¸° ì¢…ë£Œë¨" : "ê²½ê¸° ì§„í–‰ ì¤‘";
    } catch (e) {
      console.error(e);
    }
  })();
</script>
</body>
</html>
